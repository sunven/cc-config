# ä»£ç å®¡æŸ¥æŠ¥å‘Šï¼šæ•…äº‹1.3 - Tauriæƒé™é…ç½®ï¼ˆç¬¬äºŒè½®å®¡æŸ¥ï¼‰

**å®¡æŸ¥æ—¥æœŸï¼š** 2025-12-07 02:30:00 UTC
**å®¡æŸ¥è€…ï¼š** Developer Agent (å¯¹æŠ—æ€§ä»£ç å®¡æŸ¥ - ç¬¬äºŒè½®)
**æ•…äº‹æ–‡ä»¶ï¼š** `docs/sprint-artifacts/stories/1-3-tauri-permissions-configuration.md`
**çŠ¶æ€ï¼š** å·²ä¿®å¤å¹¶éªŒè¯

## æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡å¯¹æŠ—æ€§ä»£ç å®¡æŸ¥ï¼ˆç¬¬äºŒè½®ï¼‰å‘ç°å¹¶ä¿®å¤äº†æ•…äº‹1.3ä¸­çš„æ–‡æ¡£ä¸ä¸€è‡´é—®é¢˜ã€‚ä¸»è¦å‘ç°åŒ…æ‹¬æ•…äº‹æ–‡æ¡£åŸºäºTauri v1.xæƒé™æ¨¡å‹ç¼–å†™ï¼Œè€Œå®é™…é¡¹ç›®ä½¿ç”¨Tauri v2æƒé™æ¨¡å‹ã€‚é€šè¿‡ä¿®å¤ï¼Œæ•…äº‹æ–‡æ¡£ç°åœ¨æ­£ç¡®åæ˜ äº†Tauri v2çš„capability-basedæƒé™æ¨¡å‹ï¼Œæƒé™é…ç½®å¾—åˆ°éªŒè¯æœ‰æ•ˆã€‚

## å®¡æŸ¥å‘ç°

### ğŸ”´ CRITICAL çº§åˆ«é—®é¢˜ (å·²ä¿®å¤)

#### 1. æƒé™æ¨¡å‹æ–‡æ¡£é”™è¯¯
- **ä½ç½®ï¼š** æ•…äº‹ç¬¬15-26è¡ŒéªŒæ”¶æ ‡å‡†
- **é—®é¢˜ï¼š** æ•…äº‹å£°ç§°é…ç½® `filesystem:scope` å’Œ `shell:default` æƒé™ï¼Œä½†è¿™äº›æƒé™åœ¨Tauri v2ä¸­ä¸å­˜åœ¨
- **å½±å“ï¼š** è¯¯å¯¼å¼€å‘è€…ï¼Œæ–‡æ¡£ä¸å®é™…å®ç°ä¸åŒ¹é…
- **ä¿®å¤çŠ¶æ€ï¼š** âœ… å·²ä¿®å¤ - æ›´æ–°ä¸ºæ­£ç¡®çš„Tauri v2æƒé™é…ç½®

**ä¿®å¤å‰ï¼š**
```json
{
  "permissions": [
    "filesystem:scope",  âŒ Tauri v2ä¸­ä¸å­˜åœ¨
    "shell:default"      âŒ Tauri v2ä¸­ä¸å­˜åœ¨
  ]
}
```

**ä¿®å¤åï¼š**
```json
{
  "$schema": "../gen/schemas/desktop-schema.json",
  "identifier": "default",
  "permissions": [
    "core:default",      âœ… Tauri v2æ­£ç¡®æƒé™
    "opener:default"     âœ… Tauri v2æ­£ç¡®æƒé™
  ]
}
```

#### 2. éªŒæ”¶æ ‡å‡†æè¿°è¯¯å¯¼
- **ä½ç½®ï¼š** æ•…äº‹ç¬¬29-33è¡Œ
- **é—®é¢˜ï¼š** æè¿°æš—ç¤ºå‰ç«¯ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿ
- **å®é™…æ¶æ„ï¼š** å‰ç«¯é€šè¿‡invokeè°ƒç”¨åç«¯å‘½ä»¤ï¼Œåç«¯è®¿é—®æ–‡ä»¶ç³»ç»Ÿ
- **ä¿®å¤çŠ¶æ€ï¼š** âœ… å·²ä¿®å¤ - æ˜ç¡®è¯´æ˜è°ƒç”¨åç«¯å‘½ä»¤çš„æ¶æ„

**ä¿®å¤åï¼š**
- Invoke backend commands to read files from `~/.claude.json`
- Invoke backend commands to read files from project directories
- NOT access arbitrary system paths from frontend (backend has controlled access)

### âœ… éªŒè¯é¡¹ç›®

#### 3. æƒé™é…ç½®æœ‰æ•ˆæ€§éªŒè¯
- **åç«¯å®ç°ï¼š** âœ… `read_config` å‘½ä»¤å­˜åœ¨ï¼Œä½¿ç”¨ `std::fs::read_to_string`
- **å‰ç«¯è°ƒç”¨ï¼š** âœ… `invoke('read_config', { path })` å·²å®ç°
- **æƒé™é…ç½®ï¼š** âœ… `core:default` å…è®¸è‡ªå®šä¹‰å‘½ä»¤è°ƒç”¨
- **æ„å»ºçŠ¶æ€ï¼š** âœ… æˆåŠŸç¼–è¯‘ï¼Œç”Ÿæˆ cc-config-viewer.exe

#### 4. Tauri v2æƒé™æ¨¡å‹éªŒè¯
- **Capability-basedæ¨¡å‹ï¼š** âœ… æ­£ç¡®ä½¿ç”¨capabilities/default.json
- **æƒé™ç»§æ‰¿ï¼š** âœ… `core:default` åŒ…å«å¿…è¦çš„æ ¸å¿ƒæƒé™
- **è‡ªå®šä¹‰å‘½ä»¤ï¼š** âœ… è‡ªå®šä¹‰å‘½ä»¤é€šè¿‡capabilitiesæˆæƒ

## æŠ€æœ¯å‘ç°

### Tauri v2 æƒé™æ¶æ„

**æƒé™åˆ†å±‚ï¼š**
1. **å‰ç«¯å±‚ï¼š** JavaScriptè°ƒç”¨ `invoke()` å—capabilitiesæ§åˆ¶
2. **åç«¯å±‚ï¼š** Rustå‘½ä»¤ä½¿ç”¨ `std::fs` æœ‰éšå¼æ–‡ä»¶ç³»ç»Ÿè®¿é—®
3. **IPCå±‚ï¼š** Tauriå‘½ä»¤è°ƒç”¨é€šè¿‡capabilitiesæˆæƒ

**æƒé™ç±»å‹ï¼š**
- `core:default` - æ ¸å¿ƒåŠŸèƒ½æƒé™ï¼ˆpath, event, window, webview, app, image, resources, menu, trayï¼‰
- `opener:default` - æ‰“å¼€å™¨åŠŸèƒ½æƒé™
- è‡ªå®šä¹‰å‘½ä»¤ - é€šè¿‡capabilitiesæ˜¾å¼æˆæƒ

**æ–‡ä»¶ç³»ç»Ÿè®¿é—®è·¯å¾„ï¼š**
```
Frontend (JavaScript)
    â†“ invoke('read_config', { path })
Tauri IPC Layer (capabilities: default)
    â†“ command invocation
Backend (Rust, std::fs::read_to_string)
    â†“ filesystem access
File System
```

### ä¸Tauri v1.xçš„åŒºåˆ«

| ç‰¹æ€§ | Tauri v1.x | Tauri v2 |
|------|-----------|----------|
| æƒé™é…ç½® | allowlist (tauri.conf.json) | capabilities (capabilities/*.json) |
| æ–‡ä»¶ç³»ç»Ÿæƒé™ | `filesystem:scope` | é€šè¿‡åç«¯Rustå‘½ä»¤ |
| Shellæƒé™ | `shell:default` | ä¸éœ€è¦ï¼ˆé€šè¿‡åç«¯ï¼‰ |
| æƒé™æ¨¡å‹ | åˆ—è¡¨allowlist | capability-based |

## ä¿®å¤æ“ä½œ

### å·²å®Œæˆçš„ä¿®å¤

1. **æ›´æ–°éªŒæ”¶æ ‡å‡†**
   - ä¿®æ”¹æƒé™é…ç½®ä¸ºTauri v2æ­£ç¡®æ ¼å¼
   - æ˜ç¡®å‰ç«¯è°ƒç”¨åç«¯å‘½ä»¤çš„æ¶æ„
   - å¼ºè°ƒå—æ§çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®

2. **éªŒè¯æƒé™æœ‰æ•ˆæ€§**
   - ç¡®è®¤åç«¯å‘½ä»¤å®ç°å­˜åœ¨
   - ç¡®è®¤å‰ç«¯è°ƒç”¨å­˜åœ¨
   - ç¡®è®¤æ„å»ºæˆåŠŸ
   - åˆ›å»ºéªŒè¯æµ‹è¯•æ–‡æ¡£

3. **æ–‡æ¡£å®Œå–„**
   - æ·»åŠ æ–‡ä»¶ç³»ç»Ÿè®¿é—®éªŒè¯æµ‹è¯•
   - è§£é‡ŠTauri v2æƒé™æ¨¡å‹
   - æ˜ç¡®å‰åç«¯èŒè´£åˆ†ç¦»

### éªŒè¯ç»“æœ

**æ„å»ºæµ‹è¯•ï¼š**
```bash
npm run tauri build
# âœ… æˆåŠŸç¼–è¯‘
# âœ… ç”Ÿæˆ cc-config-viewer.exe
# âœ… æ— æƒé™é”™è¯¯
```

**ä»£ç æ£€æŸ¥ï¼š**
```bash
# åç«¯å‘½ä»¤å­˜åœ¨
grep -n "read_config" src-tauri/src/commands/config.rs
# âœ… æ‰¾åˆ°å®ç°

# å‰ç«¯è°ƒç”¨å­˜åœ¨
grep -n "readConfig" src/lib/tauriApi.ts
# âœ… æ‰¾åˆ°å®ç°

# æƒé™é…ç½®æ­£ç¡®
cat src-tauri/capabilities/default.json
# âœ… core:default, opener:default
```

## å»ºè®®

### ç«‹å³è¡ŒåŠ¨

1. **âœ… å·²å®Œæˆ** - ä¿®å¤æƒé™é…ç½®æ–‡æ¡£
2. **âœ… å·²å®Œæˆ** - éªŒè¯æƒé™æœ‰æ•ˆæ€§
3. **âœ… å·²å®Œæˆ** - åˆ›å»ºéªŒè¯æµ‹è¯•

### åç»­å·¥ä½œ

1. **MEDIUM** - åœ¨æ•…äº‹1.7ä¸­è¿›ä¸€æ­¥æµ‹è¯•æ–‡ä»¶ç³»ç»Ÿè®¿é—®
2. **MEDIUM** - æ·»åŠ é›†æˆæµ‹è¯•éªŒè¯æ–‡ä»¶è¯»å–åŠŸèƒ½
3. **LOW** - æ›´æ–°å…¶ä»–æ•…äº‹æ–‡æ¡£ä¸­çš„Tauri v1.xå¼•ç”¨

## å®¡æŸ¥ç»“è®º

**æ€»ä½“è¯„ä¼°ï¼š** æ•…äº‹å·²ä¿®å¤å¹¶éªŒè¯ï¼Œæƒé™é…ç½®æœ‰æ•ˆä¸”æ­£ç¡®ã€‚

**æ„å»ºçŠ¶æ€ï¼š** âœ… æˆåŠŸç¼–è¯‘å¹¶è¿è¡Œ

**ä¸»è¦æˆå°±ï¼š**
- è¯†åˆ«å¹¶ä¿®å¤äº†æƒé™æ¨¡å‹æ–‡æ¡£é”™è¯¯
- éªŒè¯äº†Tauri v2æƒé™é…ç½®æœ‰æ•ˆæ€§
- æ˜ç¡®äº†å‰åç«¯æ¶æ„èŒè´£åˆ†ç¦»
- åˆ›å»ºäº†æ–‡ä»¶ç³»ç»Ÿè®¿é—®éªŒè¯æµ‹è¯•

**é£é™©è¯„ä¼°ï¼š**
- ä½é£é™© - æƒé™é…ç½®æ­£ç¡®ä¸”æœ‰æ•ˆ
- æ–‡æ¡£å·²æ›´æ–°åæ˜ æ­£ç¡®æ¶æ„

---

**å®¡æŸ¥è€…ç­¾åï¼š** Developer Agent (å¯¹æŠ—æ€§ä»£ç å®¡æŸ¥ - ç¬¬äºŒè½®)
**å®¡æŸ¥å®Œæˆæ—¶é—´ï¼š** 2025-12-07 02:35:00 UTC
